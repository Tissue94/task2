<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<!-- 지도를 표시할 div 입니다 -->
<div id="map" style="width:100vw;height:50vh;"></div>
<div id="result"></div>


<div >
    <button onclick="loadData('http://localhost:5555/w17/1team.json')">1팀</button>
    <button onclick="loadData('http://localhost:5555/w17/2team.json')">2팀</button>
    <button onclick="loadData('http://localhost:5555/w17/3team.json')">3팀</button>
</div>

<ul class="storeList", id="list">

</ul>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=b9876c9593361f15507fdced0f12f6ce"></script> <!-- api값 중요!! -->
<script>
    var mapContainer = document.getElementById('map'), // 지도를 표시할 div
        mapOption = {
            center: new kakao.maps.LatLng(37.4997261,127.0288209), // 지도의 중심좌표
            level: 4 // 지도의 확대 레벨
        };

    // 지도를 표시할 div와  지도 옵션으로  지도를 생성합니다
    var map = new kakao.maps.Map(mapContainer, mapOption);
</script>

<script>

    kakao.maps.event.addListener(map, 'click', function(mouseEvent) {

        // 클릭한 위도, 경도 정보를 가져옵니다
        var latlng = mouseEvent.latLng;

        var message = '클릭한 위치의 위도는 ' + latlng.getLat() + ' 이고, ';
        message += '경도는 ' + latlng.getLng() + ' 입니다';

        var resultDiv = document.getElementById('result');
        resultDiv.innerHTML = message;

    });
</script>

<script>

    function loadData(serverInfo){

        console.log("loadData: " + serverInfo)

        fetch(serverInfo)
            .then(response => response.json())
            .then(data => {
                //console.log(data)
                makeList(data)
            })

    }
    const markerArr = []

    function  makeList(arr){
        const ulEle = document.querySelector(".storeList")
        let str = ''

        for (let i = 0; i < arr.length; i++) {
            console.log(arr[i])
            str += `<li data-name="${arr[i].name}" data-lat="${arr[i].lat}" data-lng="${arr[i].lng}">${arr[i].name}</lidata->`
        }// data-name 같이 data를 표현할 수 있다 (data속성)
        ulEle.innerHTML = str

        for (let i = 0; i < markerArr.length; i++) {
            markerArr[i].setMap(null)
        }

        for (let i = 0; i <arr.length; i++) {
            const store = arr[i]
            const latLng = new kakao.maps.LatLng(store.lat, store.lng)
            const marker = new kakao.maps.Marker({
                map:map,
                position: latLng,
                title: store.name
            })
            markerArr.push(marker)

        }
    }

    document.querySelector(".storeList").addEventListener("click", (e) => {
        e.stopPropagation()
        e.preventDefault()

        const target = e.target
        if(target.tagName !== 'LI'){
            return
        }

        const ui = document.getElementsByClassName("#list")
        const item = list.getElementsByTagName("li")

        for (let i = 0; i < item.length ;i++) {
            if(item[i] !== target){
                item[i].remove()
            }
        }

        console.log(target)

        const name = target.getAttribute("data-name")
        const lat = target.getAttribute("data-lat")
        const lng = target.getAttribute("data-lng")

    }, false)








</script>



</body>
</html>